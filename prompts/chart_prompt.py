"""
prompts/chart_prompt.py
차트 프롬프트 (경쟁사 스타일 학습)

개선 사항:
- 차트 타입 명확히 명시 (원그래프, 막대그래프 등)
- 구조적 설명 (첫 번째, 두 번째, ...)
- 인사이트 제공 (가장 높은/낮은 값, 패턴)
"""


def get_chart_prompt(subtypes: list = None) -> str:
    """
    차트 설명 프롬프트
    
    Args:
        subtypes: ['pie', 'bar', 'line'] 등
    
    Returns:
        프롬프트 문자열
    """
    
    # 세부 타입별 가이드
    subtype_guides = []
    
    if not subtypes or 'unknown' in subtypes:
        # 기본 가이드
        subtype_guides.append("""
차트 형태를 먼저 파악하세요:
- 원그래프 (파이 차트): 비율/구성비
- 막대그래프: 항목별 수치 비교
- 선그래프: 시간에 따른 변화 추이
- 복합 차트: 여러 차트가 함께 있는 경우
""")
    
    if 'pie' in subtypes:
        subtype_guides.append("""
**원그래프 (파이 차트) 설명 방법:**
예시: "첫 번째 차트는 원그래프 형태로 응답자의 성별 분포를 나타냅니다. 
남성은 45.2%를 차지하며, 여성은 54.8%로 여성 응답자의 비중이 더 높음을 보여줍니다."

- 차트 형태를 명확히 언급 ("원그래프 형태로")
- 각 항목의 비율을 정확히 나열
- 주요 인사이트 제공 (가장 큰/작은 비중)
""")
    
    if 'bar' in subtypes:
        subtype_guides.append("""
**막대그래프 설명 방법:**
예시: "두 번째 차트는 막대그래프 형태로 응답자의 연령대별 분포를 나타냅니다. 
각 연령대별 비율은 다음과 같습니다. 14~19세는 11.2%, 20대는 25.9%로 가장 높은 비율을 보입니다..."

- 차트 형태 명시 ("막대그래프 형태로", "가로 막대그래프" 등)
- 방향 명시 (수직/수평)
- 순위 정보 제공 (가장 높은, 두 번째로 많은 등)
""")
    
    if 'line' in subtypes:
        subtype_guides.append("""
**선그래프 설명 방법:**
예시: "이 선그래프는 2020년부터 2024년까지 매출 추이를 보여줍니다. 
2020년 100억원에서 시작하여 2024년 250억원까지 지속적인 상승세를 보입니다."

- 시간 범위 명시
- 변화 패턴 설명 (상승/하락/정체)
- 주요 변곡점 언급
""")
    
    prompt = f"""
당신은 차트 이미지를 자세히 설명하는 전문가입니다.
이미지를 보고 **경쟁사 수준의 상세하고 구조적인 설명**을 작성하세요.

{chr(10).join(subtype_guides)}

---

## 📋 설명 작성 가이드라인

### 1️⃣ 차트 형태 명확히 명시
❌ 나쁜 예: "이 차트는 데이터를 보여줍니다"
✅ 좋은 예: "첫 번째 차트는 원그래프 형태로 응답자의 성별 분포를 나타냅니다"

### 2️⃣ 구조적 설명 (복합 차트인 경우)
- "첫 번째 차트는 ...", "두 번째 차트는 ..."으로 구분
- 각 차트의 목적과 내용을 명확히 분리

### 3️⃣ 수치 정확히 나열
❌ 나쁜 예: "남성과 여성의 비율이 있습니다"
✅ 좋은 예: "남성은 45.2%를 차지하며, 여성은 54.8%입니다"

### 4️⃣ 단위 명시
- 백분율: "%"
- 금액: "원", "달러"
- 인원: "명"

### 5️⃣ 인사이트 제공
✅ "20대가 25.9%로 가장 높은 비율을 보입니다"
✅ "이 데이터를 통해 여성 응답자가 과반수임을 알 수 있습니다"
✅ "전년 대비 30% 증가하여 큰 성장세를 보입니다"

### 6️⃣ 자연스러운 문장 흐름
- 불렛 포인트와 문단을 적절히 혼합
- 너무 길지 않은 문장 (1-2줄)
- 명확한 접속사 사용

---

## 📝 출력 형식

```markdown
[전체 개요 - 차트가 무엇을 보여주는지]

[차트 1 설명]
- 차트 형태: "원그래프 형태로", "막대그래프 형태로"
- 주요 항목과 수치
- 인사이트

[차트 2 설명 (있는 경우)]
- ...

[전체 요약 또는 패턴]
```

---

## 🚨 주의사항

1. **차트 타입을 절대 틀리지 마세요**
   - 원그래프 ≠ 막대그래프
   - 정확한 형태 파악 후 설명

2. **수치를 정확히 읽으세요**
   - 반올림하지 말고 있는 그대로
   - 단위를 빠뜨리지 말 것

3. **모든 요소를 빠짐없이 설명하세요**
   - 범례, 축 레이블, 데이터 포인트 모두 포함

4. **마크다운 형식을 사용하세요**
   - 제목: ##, ###
   - 강조: **굵게**
   - 리스트: -, *

이제 이미지를 분석하고 위 가이드에 따라 설명을 작성하세요.
"""
    
    return prompt.strip()


# 예시 사용
if __name__ == '__main__':
    # 원그래프 + 막대그래프
    prompt = get_chart_prompt(subtypes=['pie', 'bar'])
    print(prompt)