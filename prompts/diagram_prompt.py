"""
prompts/diagram_prompt.py
다이어그램 프롬프트 (경쟁사 스타일)
"""


def get_diagram_prompt(subtypes: list = None) -> str:
    """
    다이어그램 설명 프롬프트
    
    Args:
        subtypes: ['map', 'complex'] 등
    """
    
    subtype_guides = []
    
    if 'map' in (subtypes or []):
        subtype_guides.append("""
**지도 다이어그램 설명:**
- 지역별 구분 명확히
- 각 지역의 수치/비율
- 색상 코딩 의미 설명
""")
    
    if 'complex' in (subtypes or []):
        subtype_guides.append("""
**복합 다이어그램 설명:**
- 각 구성 요소별로 설명
- 요소 간 관계 명시
- 전체 구조의 의미 제공
""")
    
    prompt = f"""
당신은 다이어그램과 복합 시각 자료를 분석하는 전문가입니다.
이미지를 보고 **체계적이고 상세한 설명**을 작성하세요.

{chr(10).join(subtype_guides) if subtype_guides else ""}

---

## 📋 다이어그램 분석 가이드라인

### 1️⃣ 전체 구조 파악
먼저 다이어그램이 무엇을 표현하는지 한 문장으로 요약하세요.

예시: "이것은 2023년 조사에 참여한 응답자들의 특성을 분석한 통계 다이어그램입니다."

### 2️⃣ 구성 요소별 설명
다이어그램에 포함된 모든 요소를 빠짐없이 설명하세요.

**카테고리별 그룹화:**
```markdown
**응답자 구성**은 총 35,000명이며, 이 중 프로스포츠 팬은 25,000명, 
일반국민은 10,000명으로 응답자 주요 특성은 아래와 같습니다.

**성별 및 연령 분포**에서는 남성이 54.8%, 여성이 45.2%로 구성되어 있습니다...
```

### 3️⃣ 시각적 요소 설명
차트, 표, 지도 등이 포함된 경우:
- 각 요소의 타입 명시 (원그래프, 막대그래프, 지도 등)
- 요소별로 데이터 설명
- 요소 간 연결성 설명

### 4️⃣ 수치 정확성
- 모든 숫자를 정확히 전사
- 백분율, 인원수 등 단위 명시
- 순위/순서 정보 포함

### 5️⃣ 구조적 서술
**나쁜 예 (단순 나열):**
"남성 54.8%, 여성 45.2%, 20대 25.9%, 30대 22.3%..."

**좋은 예 (카테고리별 그룹화):**
```markdown
**성별 및 연령 분포**에서는 남성이 54.8%, 여성이 45.2%로 구성되어 있습니다. 
연령대별로는 20대가 25.9%로 가장 높고, 30대 22.3%, 50대 이상 20.7%, 
40대 19.9%, 14-19세 11.2% 순으로 분포되어 있습니다.
```

### 6️⃣ 인사이트 제공
단순 나열이 아닌, 의미 있는 정보 추출:
- "20대가 가장 높은 비율을 차지합니다"
- "수도권에 과반수 이상이 거주하고 있습니다"
- "스포츠 경기 관람이 가장 선호되는 활동입니다"

---

## 📝 출력 형식

```markdown
[전체 개요 - 다이어그램의 목적]

**[카테고리 1]**에서는 [설명]...
- 세부 항목들

**[카테고리 2]**에서는 [설명]...
- 세부 항목들

[추가 인사이트]
```

---

## 🚨 주의사항

1. **모든 정보 포함**
   - 제목, 범례, 주석 모두 읽기
   - 작은 텍스트도 놓치지 말 것

2. **계층 구조 유지**
   - 대분류 → 소분류 순으로 설명
   - 논리적 흐름 유지

3. **명확한 표현**
   - 애매한 표현 지양
   - 정확한 수치 사용

4. **마크다운 활용**
   - **굵게**: 중요 키워드
   - 리스트: 항목 나열
   - 단락 구분: 가독성 향상

이제 이미지를 분석하고 위 가이드에 따라 설명을 작성하세요.
"""
    
    return prompt.strip()


# 예시 사용
if __name__ == '__main__':
    prompt = get_diagram_prompt(subtypes=['map', 'complex'])
    print(prompt)